# HAR 파일을 활용한 JMeter 스크립트 생성

보안 정책(HSTS), 인증서 충돌, 또는 사내 보안 프로그램으로 인해 JMeter의 HTTP(S) Test Script Recorder가 작동하지 않을 때 가장 확실한 대안은 **HAR(HTTP Archive) 파일**을 활용하는 것입니다.

브라우저가 통신 기록을 직접 파일로 저장한 뒤 이를 JMeter용 스크립트(.jmx)로 변환하는 전체 프로세스를 정리해 드립니다.

## 1단계: 브라우저에서 HAR 파일 추출 (Firefox/Chrome)

가장 먼저 사용자의 실제 행동을 브라우저에 기록하고 파일로 내보내야 합니다.

1. **브라우저 개발자 도구(F12)**를 열고 Network 탭으로 이동합니다.
2. **Preserve Log (로그 유지)** 체크박스를 활성화합니다. (페이지 이동 시 로그가 지워지는 것을 방지)
3. 기존에 쌓인 로그를 삭제(Clear)한 뒤, 테스트할 시나리오(로그인 → 검색 → 결제 등)를 수행합니다.
4. 기록이 완료되면 목록 위에서 마우스 우클릭 후 **[Save all as HAR with content]**를 선택하여 파일을 저장합니다.

## 2단계: HAR 파일을 JMX로 변환하는 방법 (2가지)

상황에 따라 온라인 변환기를 쓰거나, 보안이 중요하다면 로컬 오픈소스 도구를 사용합니다.

### 방법 A: 오픈소스 har2jmeter 활용 (로컬 변환 / 권장)

보안상 외부 사이트에 파일을 올리기 어렵다면 Python 기반의 har2jmeter를 추천합니다.

**설치 (Python 환경 필요)**:
```bash
pip install har2jmeter
```

**변환 실행**: 터미널에서 저장된 HAR 파일이 있는 경로로 이동하여 아래 명령어를 입력합니다.
```bash
har2jmeter target_file.har
```

**결과**: 동일한 위치에 target_file.jmx 파일이 생성됩니다. 로컬에서 작업하므로 데이터 유출 위험이 없습니다.

### 방법 B: BlazeMeter 온라인 변환기 활용

가장 간편한 방법이지만, 파일을 외부 서버에 업로드해야 한다는 점을 유의하세요.

1. [BlazeMeter Converter](https://converter.blazemeter.com/) 접속
2. 저장한 .har 파일을 업로드하고 Convert 클릭
3. 생성된 .jmx 파일을 다운로드하여 JMeter에서 엽니다.

## 3단계: JMeter에서 스크립트 정제 (사후 처리)

변환된 스크립트는 모든 통신 기록을 담고 있으므로, 실제 테스트용으로 다듬는 과정이 필수입니다.

- **정적 리소스 필터링**: 이미지(.png, .jpg), 스타일시트(.css), 폰트 등 API 성능과 무관한 요청(Sampler)들을 수동으로 삭제합니다.
- **HTTP Cookie Manager 추가**: 변환 도구에 따라 쿠키 설정이 누락될 수 있습니다. 세션 유지를 위해 Thread Group 최상단에 추가하세요.
- **동적 값 처리 (연관화 / Correlation)**: HAR에 기록된 토큰(Bearer Token, Session ID 등)은 과거의 값입니다.
  - 이전 응답에서 값을 추출할 JSON Extractor나 Regular Expression Extractor를 추가합니다.
  - 하드코딩된 값을 ${variable} 형태로 치환합니다.

## 4단계: 테스트 수행 및 검증

1. View Results Tree를 추가하고 1명의 가상 사용자(1 Thread)로 테스트를 실행합니다.
2. 응답 결과에서 로그인 세션이나 데이터가 정상적으로 처리되는지 확인합니다.
3. 성공했다면 Thread Group에서 동시 사용자 수를 늘려 본격적인 부하 테스트를 수행합니다.

## 💡 요약: 왜 이 방식이 좋은가?

- **보안 우회**: 브라우저가 이미 인증을 마친 데이터를 기록하므로 HTTPS 복호화 설정이 필요 없습니다.
- **안정성**: 레코딩 도중 끊기거나 꼬이는 현상이 적고, 실제 사용자 브라우저의 트래픽을 가장 정확하게 반영합니다.
- **정확성**: 브라우저가 실제로 보낸 요청을 그대로 기록하므로, JMeter 레코딩 시 발생할 수 있는 오류나 누락을 방지할 수 있습니다.
- **유연성**: 복잡한 인증 흐름이나 보안 정책이 강한 사이트에서도 사용 가능합니다.