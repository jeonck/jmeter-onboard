# JMeter Correlation 실습: 카테고리에서 상품 선택

카테고리를 선택했을 때 하위 상품 ID를 추출하여 상세 페이지로 이동하는 시나리오는 Correlation(연관성 처리)을 이해하기에 가장 완벽한 예시입니다.

매번 사이트를 방문할 때마다 '추천 상품'이나 '카테고리 순서'가 바뀔 수 있기 때문에, 고정된 ID가 아닌 실시간으로 화면에 보이는 값을 낚아채는 것이 핵심입니다.

## 1. Correlation 실습 시나리오: 카테고리에서 상품 선택

### [Step 1] 카테고리 페이지 접속 (데이터 발생)

사용자가 '전자제품' 카테고리를 클릭합니다. 서버는 응답으로 여러 상품의 리스트가 담긴 HTML을 보내줍니다.

**서버의 응답(HTML) 예시**:
```html
<ul>
  <li><a href="/product?id=PROD_001">최신형 노트북</a></li>
  <li><a href="/product?id=PROD_882">무선 마우스</a></li>
  <li><a href="/product?id=PROD_503">기계식 키보드</a></li>
</ul>
```

### [Step 2] 추출기 설정 (값 낚아채기)

'카테고리 접속' 요청 바로 아래에 Regular Expression Extractor를 추가하여 상품 ID를 변수에 담습니다.

**추출 설정**:
- Reference Name: SELECTED_ID (내가 정한 변수 이름)
- Regular Expression: id=(PROD_.+?)" (이것이 만능 정규식의 원리입니다)
- Template: $1$
- Match No.: 0 (Random 선택 - 매번 다른 상품을 클릭하는 효과!)

### [Step 3] 상품 상세 페이지 요청 (변수 사용)

이제 다음 HTTP Request(상세 페이지)에서 하드코딩된 값 대신 변수를 사용합니다.

- Path: /product?id=${SELECTED_ID}

## 2. '만능' 정규 표현식 공식: (.+?)

JMeter에서 가장 강력하고 널리 쓰이는 정규식 패턴은 **(.+?)**입니다. 이를 활용하는 공식은 다음과 같습니다.

**공식**: 찾고싶은값앞의문자(.+?)찾고싶은값뒤의문자

### 구조 분석
- **. (Dot)**: 어떤 문자든 올 수 있음.
- **+ (Plus)**: 한 글자 이상 있음.
- **? (Question)**: 최소 일치(Non-greedy). 뒤에 오는 종료 문자를 만나는 즉시 멈춤. (이게 없으면 문서 끝까지 다 먹어버릴 수 있습니다.)
- **() (Parentheses)**: 이 괄호 안의 내용만 추출하여 변수에 담겠다는 뜻.

### 실전 활용 예시

| 추출 대상 | 응답 데이터 (HTML/Text) | 정규 표현식 (Regex) |
|-----------|--------------------------|---------------------|
| 상품 ID | id=PROD_12345 | "id=(.+?)" |
| 세션 토큰 | session_token: 'ABC-789' | "session_token: '(.+?)'" |
| 게시글 제목 | <h1>환영합니다!</h1> | "<h1>(.+?)</h1>" |
| JSON 값 | "userId": 1004, | ""userId": (.+?)," |

## 3. 왜 Match No. 0(Random)이 유용한가요?

부하 테스트를 할 때 모든 가상 사용자가 1번 상품(PROD_001)만 클릭한다면, 해당 상품의 데이터만 DB 캐시에 올라가서 성능이 실제보다 좋게 측정될 수 있습니다.

Match No. 0을 설정하면, JMeter가 정규식에 일치하는 여러 상품 중 랜덤하게 하나를 골라 ${SELECTED_ID}에 넣어줍니다.

결과적으로 t3.medium 서버에 골고루 부하가 분산되어, 실제 서비스 환경과 매우 유사한 데이터를 Scouter에서 모니터링할 수 있게 됩니다.

## 💡 확인 작업 (Debug Sampler)

Correlation이 잘 되었는지 확인하려면 Debug Sampler를 추가하고 실행한 뒤, View Results Tree에서 SELECTED_ID=PROD_882 처럼 값이 잘 들어와 있는지 확인해 보세요.