# JMeter Constant Throughput Timer

JMeter의 Constant Throughput Timer는 앞서 설명한 Pacing(페이싱) 원리를 아주 쉽게 구현해 주는 컴포넌트입니다. 이 타이머의 핵심은 "사용자가 얼마나 쉬느냐"를 설정하는 것이 아니라, **"서버에 초당/분당 몇 개의 요청을 보낼 것인가"**를 직접 지정하는 데 있습니다.

## 1. 주요 기능과 특징

- **목표 처리량 강제**: 가상 사용자(Thread)가 아무리 많아도, 설정된 TPS(초당 트랜잭션)를 넘지 않도록 각 스레드의 실행 속도를 자동으로 조절합니다.
- **지연 시간 자동 계산**: 서버의 응답 시간(RT)이 빠르면 더 오래 대기하고, 응답 시간이 느려지면 대기 시간을 줄여서 전체적인 Request Interval을 조절합니다.
- **분 단위 설정**: 설정 기준이 '초(Second)'가 아니라 '분(Minute)' 단위인 점이 특징입니다. (예: 10 TPS를 원하면 600 Samples per minute으로 설정)

## 2. 핵심 설정 옵션 (Calculate Throughput based on)

이 옵션에 따라 부하가 분산되는 방식이 완전히 달라집니다.

| 옵션명 | 설명 | 추천 상황 |
|--------|------|----------|
| This thread only | 각 스레드가 독립적으로 목표치를 가집니다. (설정값 × Thread 수 = 총 TPS) | 개별 유저의 행동 주기를 고정할 때 |
| All active threads | 모든 스레드가 합심하여 목표 TPS를 맞춥니다. | 가장 권장. 전체 서버 부하량을 고정할 때 |
| All active threads in current thread group | 현재 스레드 그룹 내의 인원끼리만 목표 TPS를 공유합니다. | 그룹별로 다른 부하를 줄 때 |

## 3. 작동 원리 예시 (t3.medium 서버 테스트)

목표를 **600 Samples per minute (10 TPS)**로 설정하고 Thread를 100개 만들었다고 가정해 봅시다.

**서버가 빠를 때 (RT = 0.1초)**:
- 10 TPS를 맞추기 위해 각 스레드는 요청 후 약 9.9초를 대기합니다.

**서버가 느려질 때 (RT = 5초)**:
- 타이머는 대기 시간을 5초로 줄여서 어떻게든 10 TPS를 유지하려고 노력합니다.

**한계 도달 (RT = 11초)**:
- 아무리 대기 시간을 0으로 만들어도 100명이 10 TPS를 낼 수 없습니다. 이때 비로소 TPS가 떨어지기 시작합니다. (Saturation Point 발견)

## 4. 실전 설정 팁

### ① 적절한 스레드 수 계산
TPS를 달성하려면 충분한 스레드 수가 필요합니다.
- **공식**: 필요 스레드 수 ≥ 목표 TPS × 예상 응답 시간
- 예: 50 TPS를 목표로 하고 예상 응답 시간이 2초라면, 최소 100개 이상의 스레드가 필요합니다.

### ② 타이머 배치 위치
- **Thread Group 바로 아래**: 그룹 내 모든 요청의 총합을 기준으로 TPS를 제어합니다. (대부분의 경우 이 방식이 적절)
- **특정 Sampler 아래**: 해당 요청에만 TPS 제한을 적용합니다. (특정 API에만 부하를 제한하고 싶을 때)

### ③ Scouter와 연계 분석
- Constant Throughput Timer를 사용하면 TPS가 일정하게 유지되므로, Scouter XLog에서 "어느 시점부터 응답 시간이 길어졌는지"를 명확하게 파악할 수 있습니다.
- 서버 성능이 저하되어도 TPS는 일정하므로, 응답 시간 증가가 병목 지점을 정확히 가리키게 됩니다.

## 5. 주의사항

- **배치 위치 중요**: Thread Group 상단에 배치하여 그룹 전체에 영향을 주는 것이 일반적입니다.
- **스레드 수 확보 필수**: 이 타이머는 TPS를 '낮추는' 역할만 합니다. 목표 TPS를 달성하기에 스레드 수가 부족하면 실제 TPS는 오르지 않습니다.
- **변경 사항 실시간 반영 안 됨**: 테스트 실행 중 설정값을 변경해도 즉시 반영되지 않으므로, 정적인 부하 테스트에 적합합니다.

## 💡 요약

Constant Throughput Timer는 **"서버에 가해지는 압박(TPS)을 일정하게 유지하고 싶을 때"** 사용하는 가장 강력한 도구입니다. Pacing의 원리를 GUI 설정만으로 쉽게 구현할 수 있어, 실무에서 매우 자주 사용되는 핵심 컴포넌트입니다.