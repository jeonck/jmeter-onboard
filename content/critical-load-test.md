# 임계 부하 테스트 (Critical Load Test / Stress Test)

**임계 부하 테스트(Critical Load Test / Stress Test)**는 시스템이 정상적으로 동작할 수 있는 **최대 한계점(Saturation Point)**이 어디인지, 그리고 그 한계를 넘었을 때 시스템이 어떻게 반응하는지를 확인하는 테스트입니다.

단순히 성능을 측정하는 것을 넘어, 시스템의 **'파괴 지점'**을 찾아내어 장애에 대비하는 것이 목적입니다.

## 1. 임계 부하 테스트의 목적

- **최대 수용량 파악**: 우리 시스템이 무너지지 않고 버틸 수 있는 '동시 사용자'와 'TPS'의 절대적 한계치를 확인합니다.
- **장애 복구 능력(Resilience) 검증**: 한계치를 넘어 시스템이 마비되었을 때, 부하를 줄이면 다시 자동으로 정상화되는지(Self-healing) 확인합니다.
- **취약 지점(SPOF) 발견**: 부하가 극에 달했을 때 가장 먼저 응답이 끊기거나 에러를 내뱉는 컴포넌트(DB, 캐시, 네트워크 등)를 식별합니다.

## 2. 테스트 수행 방법: Step-up 방식

임계 부하 테스트는 부하를 한 번에 주지 않고, **계단식(Step-up)**으로 서서히 높여가며 시스템의 변화를 관찰하는 방식을 주로 사용합니다.

1. **초기 부하**: 예상되는 평상시 부하로 시작합니다.
2. **부하 증량**: 가상 사용자(VU)를 일정 간격으로 늘려 나갑니다.
3. **임계치 도달**: TPS가 더 이상 오르지 않고 정체되거나, 응답 시간이 기하급수적으로 늘어나는 지점을 포착합니다.
4. **파괴 단계**: 임계치를 넘어 시스템이 5xx 에러를 내뱉거나 다운될 때까지 부하를 계속 주입합니다.

## 3. 결과 분석 시 핵심 지표 (Saturation Point)

임계 부하 테스트 결과를 볼 때는 다음 두 지점을 명확히 구분해야 합니다.

| 지점 | 설명 | 분석 결과의 의미 |
|------|------|------------------|
| Throughput Max | TPS가 최대치에 도달한 지점 | 시스템이 이론적으로 처리할 수 있는 최대 성능량 |
| Response Time Spike | 응답 시간이 급격히 수직 상승하는 지점 | 사용자가 실제 불편을 느끼기 시작하는 실질적 한계선 |

## 4. 실전 분석 팁 (with Scouter & JMeter)

- **Scouter의 Active Service**: 임계점에 도달하면 Scouter의 Active Service 그래프가 내려가지 않고 가득 차게 됩니다. 이때 Thread Pool이 꽉 찼는지, DB Connection Pool이 부족한지 확인해야 합니다.
- **Error Rate**: 임계치를 넘어서는 순간 HTTP 504(Gateway Timeout)나 503(Service Unavailable) 에러가 발생하기 시작합니다. 이때의 VU 수치가 시스템의 최대 가용 인원입니다.
- **자원 고갈**: CPU 사용률이 100%에 도달했는지, 아니면 메모리가 가득 차서 GC(Garbage Collection)가 빈번하게 발생하는지 체크합니다.

## 💡 결론: 무엇을 얻어야 하는가?

임계 부하 테스트가 끝나면 반드시 다음 질문에 답할 수 있어야 합니다.

> "우리 서비스는 동시 사용자 N명에서 응답 시간이 튑니다. 장애를 방지하려면 N-100명 시점에 Auto-scaling이 작동해야 합니다."