# 성능 테스트 프로세스

성능 테스트는 단순히 툴을 실행하는 과정이 아니라, **비즈니스 요구사항을 기술적인 지표로 변환하고 이를 검증하는 체계적인 엔지니어링 과정**입니다. 

전체 프로세스는 5단계로 구성되며, 각 단계는 순차적으로 진행되면서도 필요에 따라 반복될 수 있는 유기적인 구조를 가지고 있습니다.

## 1. 분석 단계 (Analysis)

테스트의 범위와 목표를 정의하는 가장 중요한 기초 단계입니다.

### ① 대상 시스템 분석
- **아키텍처 파악**: Web/WAS/DB 구성, 서버 사양, 네트워크 구조를 확인합니다.
- **인터페이스 분석**: API 엔드포인트, 외부 연동(결제, SMS 등)을 파악합니다.
- **데이터 흐름 분석**: 사용자의 요청이 어떤 경로로 처리되는지 시각화합니다.

### ② 비즈니스 모델 분석
- **사용자 패턴**: 가장 많이 사용하는 기능(상품 검색, 장바구니, 결제 등)을 파악합니다.
- **트래픽 패턴**: 시간대별/요일별 방문자 수, 피크 시간대를 분석합니다.
- **예상 사용자 수**: 최대 동시 접속자 수, 평균 사용자 수를 산정합니다.

### ③ 성능 목표(SLO) 정의
- **TPS (Transactions Per Second)**: 초당 처리해야 할 요청 수 (예: 100 TPS)
- **응답 시간**: 허용 가능한 응답 시간 (예: p95 기준 2초 이내)
- **에러율**: 허용 가능한 실패율 (예: 0.1% 이내)
- **자원 사용률**: CPU, 메모리, 디스크 사용률 상한선 (예: 80% 이하)

### ④ 리스크 분석
- **운영 환경 영향**: 테스트 중 실제 사용자에게 미칠 수 있는 영향을 검토합니다.
- **데이터 오염**: 테스트로 인해 운영 데이터가 변경되는 가능성 분석.
- **서비스 중단**: 테스트로 인한 서버 다운 여부 및 복구 계획 수립.

## 2. 설계 단계 (Design)

분석된 데이터를 바탕으로 구체적인 실행 계획을 수립합니다.

### ① 테스트 시나리오 설계
- **단일 API 테스트**: 로그인, 상품 조회 등 개별 기능 검증.
- **복합 시나리오**: 로그인 → 상품 검색 → 장바구니 → 결제 완료와 같은 전체 흐름 검증.
- **사용자 비율**: 70%는 상품 검색, 20%는 장바구니, 10%는 결제와 같은 비율 설정.

### ② 부하 모델링
- **리틀의 법칙 적용**: $VU = TPS \times RT$ 공식을 사용하여 필요한 가상 사용자 수 산정.
- **Request Interval 계산**: 목표 TPS를 달성하기 위한 요청 주기 계산.
- **Pacing 전략**: 일정한 TPS를 유지하기 위한 Pacing 설정 계획.

### ③ 테스트 유형 결정
- **Load Test**: 예상 최대 부하(예: 500명)를 100% 수준으로 30분간 유지.
- **Stress Test**: 점진적으로 부하를 증가시켜 시스템 한계(Saturation Point) 탐색.
- **Endurance Test**: 장시간(8~24시간) 일정 부하를 유지하여 메모리 누수, 자원 고갈 검증.
- **Spike Test**: 단시간에 급격한 부하 증가(예: 1분 이내 1,000명 → 5,000명)를 시뮬레이션.

### ④ 데이터 설계
- **사용자 계정**: 테스트에 사용할 수백 개의 로그인 계정 준비.
- **테스트 데이터**: 상품 정보, 카테고리, 주문 이력 등 실제 서비스 수준의 데이터.
- **DB 볼륨**: 실제 운영 수준의 데이터 양을 반영하여 인덱스 성능 검증.

## 3. 준비 단계 (Preparation)

테스트를 실행할 수 있는 환경을 물리적으로 구축합니다.

### ① 환경 구축
- **테스트 환경**: 운영 환경과 유사한 사양의 테스트 서버 구성 (t3.medium 기준).
- **네트워크 구성**: 방화벽, 보안 그룹 설정 확인.
- **모니터링 도구**: Scouter, APM 도구 설치 및 연동 확인.

### ② 툴 세팅
- **JMeter 설치**: 부하 발생기 서버에 JMeter 설치 및 환경 설정.
- **모니터링 연동**: 서버에 Scouter Agent 설치 및 JMX Open 설정.
- **Client 설정**: 모니터링 대시보드를 볼 수 있는 Client PC 준비.

### ③ 스크립트 개발
- **시나리오 구현**: 설계된 테스트 시나리오를 JMeter 스크립트로 구현.
- **정상 동작 검증**: 1명의 사용자로 테스트하여 정상 동작 확인 (Dry Run).
- **파라미터화**: IP, 포트, 사용자 정보 등을 변수로 분리하여 유지보수성 확보.

### ④ 테스트 데이터 준비
- **DB 초기화**: 테스트 전 DB 데이터 초기화 및 테스트 데이터 삽입.
- **CSV 파일 생성**: 사용자 계정, 상품 정보 등 CSV 파일 생성.
- **서버 상태 확인**: 테스트 전 서버가 정상 상태인지 확인 (CPU, 메모리, 디스크 여유 공간 등).

## 4. 수행 단계 (Execution)

설계된 시나리오에 따라 실제 부하를 가하고 데이터를 수집합니다.

### ① 기초 테스트
- **1명 사용자 테스트**: 시나리오가 정상적으로 동작하는지 확인.
- **소수 사용자 테스트**: 10~20명 수준에서 정상 동작 확인.

### ② 단계별 부하 테스트 (Step-up)
- **계단식 부하 증가**: 100명 → 200명 → 300명 순차적으로 증가.
- **Saturation Point 탐색**: TPS가 더 이상 오르지 않고 응답 시간이 급격히 증가하는 지점 확인.
- **모니터링 병행**: Scouter, APM 도구로 실시간 서버 상태 확인.

### ③ 실시간 모니터링
- **자원 사용률**: CPU, 메모리, 디스크 I/O 실시간 확인.
- **DB 상태**: Connection Pool, Lock, Slow Query 모니터링.
- **응답 시간**: XLog에서 응답 시간이 급증하는 지점 확인.

### ④ 장애 기록
- **에러 발생 시점 기록**: 응답 지연이나 에러 발생 시간 정확히 기록.
- **로그 확보**: 서버 로그, 애플리케이션 로그 확보.
- **스크린샷**: 모니터링 도구의 이상 지표 캡처.

## 5. 평가 단계 (Evaluation)

수집된 데이터를 분석하여 결론을 도출하고 개선 방향을 제시합니다.

### ① 결과 분석
- **성능 지표 비교**: 수집된 TPS, 응답 시간, 에러율이 목표치(SLO)를 만족하는지 비교.
- **트렌드 분석**: 시간에 따른 성능 지표 변화 추이 분석.
- **이상 지점 확인**: 특정 시간대에 성능이 저하된 구간 분석.

### ② 병목 지점(Bottleneck) 식별
- **APM 도구 활용**: Scouter XLog를 통해 응답 시간이 느렸던 구간의 코드나 SQL 특정.
- **DB 분석**: Slow Query, Connection Pool 부족, Index 미사용 등 분석.
- **서버 자원**: CPU 100%, 메모리 부족, Thread Pool 고갈 등 확인.

### ③ 튜닝 및 재테스트
- **튜닝 방안 제시**: 인덱스 추가, 스레드 풀 확장, GC 설정 조정 등.
- **튜닝 적용**: 제안된 방안을 적용 후 서버 재시작.
- **재테스트**: 동일한 조건으로 재테스트하여 성능 개선 여부 확인.

### ④ 최종 결과 보고
- **성능 지표 요약**: TPS, 응답 시간, 에러율 등 주요 지표 요약.
- **한계 분석**: 수용 가능한 최대 동시 사용자 수, 시스템 한계 지점 명시.
- **개선 제안**: 향후 성능 개선을 위한 구체적인 제안 사항 정리.

## 💡 실전 팁

- **DB 데이터 볼륨 중요**: 많은 프로젝트에서 테스트 데이터 볼륨을 간과하여 실제와 동떨어진 결과가 나옵니다. 반드시 운영 수준의 데이터를 채워놓고 테스트하는 것이 중요합니다.
- **모니터링 도구 연계**: JMeter의 TPS와 응답 시간만으로는 병목 원인을 파악하기 어렵습니다. Scouter와 같은 APM 도구와 연계하여 분석해야 정확한 원인을 찾을 수 있습니다.
- **테스트 환경 일치**: 테스트 환경이 운영 환경과 다르면 성능 결과가 왜곡될 수 있습니다. 가능하면 동일한 사양, 동일한 설정의 환경을 사용하는 것이 좋습니다.
- **문서화 철저**: 테스트 조건, 설정값, 결과, 분석 내용 등을 철저히 문서화하여 향후 재사용 및 비교 분석에 활용할 수 있도록 해야 합니다.