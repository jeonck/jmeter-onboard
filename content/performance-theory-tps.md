# TPS를 포함하는 성능 테스트 이론

성능 테스트의 가장 기초가 되는 수학적 원리가 바로 **리틀의 법칙(Little's Law)**입니다. 이 법칙은 시스템 내부에 머무는 사용자 수와 처리량, 응답 시간 사이의 상관관계를 설명하며, 복잡한 시스템의 성능을 단순하고 명확하게 계산할 수 있게 해줍니다.

## 1. 리틀의 법칙 공식

$$L = \lambda \times W$$

이 공식을 성능 테스트 용어로 치환하면 다음과 같습니다.

$$Active\ User (VU) = TPS \times Response\ Time$$

- $L$ (Lead Time / Active User): 시스템 안에 머무르고 있는 평균 사용자 수 (액티브 유저).
- $\lambda$ (Arrival Rate / TPS): 단위 시간당 시스템에 들어오는(또는 나가는) 평균 요청 수 (처리량).
- $W$ (Wait Time / Response Time): 사용자가 시스템에 머무는 평균 시간 (응답 시간).

## 2. 왜 리틀의 법칙이 중요한가?

성능 테스트 중에 우리가 측정하는 세 가지 핵심 지표는 서로 독립적이지 않습니다. 하나의 수치가 변하면 반드시 다른 수치에 영향을 줍니다.

- **동시 사용자 수 예측**: 목표 TPS가 100이고 예상 응답 시간이 2초라면, 서버는 항상 최소 200명의 액티브 유저($100 \times 2$)를 감당할 수 있는 자원(Thread, DB Connection 등)을 확보하고 있어야 합니다.
- **병목 현상 진단**: 시스템의 처리량(TPS)이 고정되어 있는데 응답 시간($W$)이 길어진다면, 시스템 내의 액티브 유저($L$)가 증가하게 됩니다. 이는 결국 **대기열(Queue)**이 쌓이고 있다는 증거입니다.
- **테스트 설계의 타당성 검증**: JMeter에서 500개의 스레드를 돌렸는데 TPS가 50, 응답 시간이 10초가 나왔다면 $50 \times 10 = 500$으로 리틀의 법칙이 성립합니다. 만약 이 수치가 맞지 않는다면 테스트 환경이나 측정 방식에 오류가 있는 것입니다.

## 3. 실전 예시 (t3.medium 환경)

어느 쇼핑몰의 결제 API 성능을 테스트한다고 가정해 봅시다.

- **상황 A (정상)**: 응답 시간이 0.5초이고 서버가 초당 20건(TPS)을 처리한다면, 서버에는 항상 10명($20 \times 0.5$)의 액티브 유저가 있습니다.
- **상황 B (지연 발생)**: DB 부하로 인해 응답 시간이 5초로 늘어났는데, 유입되는 요청(TPS)이 여전히 20건이라면, 서버에는 100명($20 \times 5$)의 액티브 유저가 쌓이게 됩니다.
- **결과**: t3.medium 서버의 Thread Pool 설정이 50개라면, 상황 A는 문제가 없지만 상황 B에서는 50명을 제외한 나머지 50명은 응답을 받지 못하고 무한 대기하거나 에러(503 Service Unavailable)를 겪게 됩니다.

## 4. 리틀의 법칙과 Saturation Point

시스템이 **Saturation Point(포화 지점)**에 도달하면 리틀의 법칙에 의해 다음과 같은 현상이 발생합니다.

- 자원(CPU, Thread 등)이 꽉 차서 TPS($\lambda$)가 더 이상 증가하지 못함.
- 하지만 유입되는 사용자는 계속 늘어나므로 액티브 유저($L$)는 계속 증가.
- 공식($L = \lambda \times W$)을 유지하기 위해 응답 시간($W$)이 기하급수적으로 증가.

## 💡 요약

리틀의 법칙은 **"서버가 수용할 수 있는 액티브 유저의 한계는 이미 정해져 있으며, 응답 시간이 길어지면 그만큼 처리할 수 있는 유저 수는 줄어든다"**는 것을 수학적으로 증명합니다.