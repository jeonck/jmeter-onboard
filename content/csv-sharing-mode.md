# JMeter CSV Data Set Config - Sharing Mode

JMeter의 CSV Data Set Config에서 Sharing mode 옵션은 "가져온 데이터를 여러 가상 사용자(Thread)들 사이에서 어떻게 나눠 쓸 것인가?"를 결정하는 아주 중요한 설정입니다.

특히 t3.medium 같은 제한된 자원에서 여러 개의 Thread Group을 운영할 때, 데이터 중복이나 꼬임 현상을 방지하기 위해 이 옵션을 정확히 이해해야 합니다.

## 1. All threads (기본값) - "하나의 번호표 기계"

- **동작**: 테스트 계획(Test Plan) 내에 있는 모든 Thread Group의 모든 사용자가 하나의 CSV 파일을 공유합니다.
- **특징**: 어떤 그룹의 사용자가 요청을 보내든 상관없이, 파일에서 한 줄씩 순서대로(1번, 2번, 3번...) 읽어갑니다.
- **언제 쓰나요?**
  - 중복 로그인이 불가능한 아이디들을 여러 시나리오에서 골고루 나눠 써야 할 때.
  - 테스트 계획 전체에서 데이터의 고유성(Uniqueness)이 절대적으로 보장되어야 할 때 가장 안전한 선택입니다.

## 2. Current thread group - "그룹별 전용 번호표"

- **동작**: 동일한 Thread Group 내의 사용자들끼리만 데이터를 공유합니다.
- **특징**: 
  - Thread Group A와 B가 있다면, 각각의 그룹이 CSV 파일의 첫 번째 줄부터 따로 읽기 시작합니다.
  - 만약 두 그룹이 같은 변수명을 쓴다면 데이터가 겹칠 수 있습니다.
- **언제 쓰나요?**
  - '구매 시나리오' 그룹과 '장바구니 조회' 그룹이 각각 독립적으로 데이터를 처음부터 끝까지 소비해야 할 때 사용합니다.

## 3. Current thread - "사용자마다 개인 장부"

- **동작**: **각 개별 가상 사용자(Thread)**가 파일을 처음부터 따로 읽습니다.
- **특징**: 모든 사용자가 첫 번째 요청에서 CSV의 1행 데이터를 똑같이 가져갑니다. (비효율적일 수 있음)
- **언제 쓰나요?**
  - 매우 드문 경우지만, 각 사용자가 동일한 순서의 데이터를 반복해서 테스트해야 할 때 사용합니다. (일반적인 부하 테스트에서는 잘 쓰지 않습니다.)

## 🔍 요약 및 비교표

| 옵션 | 데이터 공유 범위 | 데이터 중복 여부 | 추천 시나리오 |
|------|------------------|------------------|----------------|
| All threads | 테스트 계획 전체 | 중복 없음 (가장 안전) | 로그인 아이디 분배 |
| Current thread group | 각 Thread Group별 | 그룹 간 중복 발생 가능 | 그룹별 독립적 데이터 소비 |
| Current thread | 각 개별 가상 사용자별 | 모든 사용자 간 중복 발생 | 사용자별 동일 패턴 반복 |

## 💡 실무 적용 팁 (t3.medium 실습 시)

- **로그인 테스트**: 무조건 **All threads**를 권장합니다. 그래야만 "이미 로그인 중인 아이디입니다"라는 서버 에러를 피할 수 있습니다.
- **Scouter 모니터링 연계**: 만약 Current thread group을 썼는데 여러 그룹에서 똑같은 아이디로 요청을 보내면, Scouter XLog 상에서 동일한 사용자의 요청이 겹쳐 보여 분석이 혼란스러울 수 있습니다. 데이터의 고유성을 위해 가급적 All threads를 활용하세요.
- **데이터 부족 현상**: Recycle on EOF?를 True로 설정했다면, 데이터가 다 소진되었을 때 다시 1번 데이터부터 읽기 시작합니다. 이때 Sharing mode 설정에 따라 어느 시점에 데이터가 겹치기 시작할지 예측할 수 있습니다.